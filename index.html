<!DOCTYPE html>
<html>
 <head>
 	<meta charset="UTF-8" />
 	<meta name="viewport" content="width=device-width, initial-scale=1">
 	<title>Aarrejahti Jyväskylä</title>
 	<link rel="stylesheet" href="css/jquery.mobile-1.3.1.min.css" type="text/css">
 	<script type="text/javascript" src="js/jquery.js"></script>
 	<script type="text/javascript" src="js/app.js"></script>
 	<script type="text/javascript" src="js/jquery.mobile-1.3.1.min.js"></script>
 	<script type="text/javascript" src="cordova.js"></script>
 	<link rel="stylesheet" href="css/app.css" type="text/css">

 <script type="text/javascript" charset="utf-8">
    // Wait for device API libraries to load
    //
    document.addEventListener("deviceready", onDeviceReady, false);
    // device APIs are available
    //
    function onDeviceReady() {
    	findLocation();
    }

    // Funktio, joka paikallistaa käyttäjän longtituden ja latituden avulla.
    function findLocation() {
        document.getElementById('geolocation').innerHTML = 'Etsitään sijaintia...';
        var options = {maximumAge: 0, timeout: 10000, enableHighAccuracy:true};
        navigator.geolocation.getCurrentPosition(onSuccess, onError, options);
    }

    // onSuccess Geolocation
    //
    function onSuccess(position) {
        var element = document.getElementById('geolocation');
        var displat = document.getElementById('latval');
        var displon = document.getElementById('lonval');

        element.innerHTML = 'Paikannettu!';
        displat.innerHTML = position.coords.latitude;
        displon.innerHTML = position.coords.longitude;
    }

    // onError Callback receives a PositionError object
    //
    function onError(error) {
        alert('Errorkoodi: '    + error.code    + '\n' +
              'Virheviesti: ' + error.message + '\n');
    }

    </script>


 </head>
 <body>

 	<div data-role="page" id="home">
 		<div data-role="header">
 			<h1>Aarrejahti Jyväskylä</h1>
 		</div>
 		<div data-role="content">

            <p id="geolocation">Etsitään sijaintia...</p>

            <div class="ui-grid-a">
                <div class="ui-block-a"><span class="highlight">Latitude:</span></div>
                <div class="ui-block-b"><span id="latval">?</span></div>
            </div>

            <div class="ui-grid-a">
                <div class="ui-block-a"><span class="highlight">Longitude:</span></div>
                <div class="ui-block-b"><span id="lonval">?</span></div>
            </div>

 			<br>
            <br>
            <button id="relocate">Paikanna</button>
            <br>
 			<button id="checkLocation">Löydä aarre!</button>
 			<p id="checkedLocation"></p>
 		</div>
 		<div data-role="footer" data-position="fixed">
 			<h1>&copy; Satu Tyrväinen 2013</h1>
 		</div>
 	</div>


 <script type="text/javascript">
 window.onload = function(){
    // 62.2427925
 	var treasureLat = 62.2427795;
    // 25.7591883
 	var treasureLon = 25.7592863;

    var checkBtn = document.getElementById('checkLocation');
	checkBtn.onclick = function(){
		var userLat = parseFloat(document.getElementById('latval').innerHTML);
		var userLon = parseFloat(document.getElementById('lonval').innerHTML);
		console.log(userLat);
		console.log(userLon);
		if ( ( (treasureLat - userLat <= 0.0009 ) && (treasureLat - userLat >= -0.0000) ) &&
			( (treasureLon - userLon <= 0.0009 ) && (treasureLon - userLon >= -0.0009) ) ) {
			document.getElementById('checkedLocation').innerHTML = 'Olet aivan aarteen lähellä!';
		}
        else if ( ( (treasureLat - userLat <= 0.002 ) && (treasureLat - userLat >= -0.002) ) &&
            ( (treasureLon - userLon <= 0.002 ) && (treasureLon - userLon >= -0.002) ) ) {
            document.getElementById('checkedLocation').innerHTML = 'Alkaa jo polttaa.';
        }
        else if ( ( (treasureLat - userLat <= 0.005 ) && (treasureLat - userLat >= -0.005) ) &&
            ( (treasureLon - userLon <= 0.005 ) && (treasureLon - userLon >= -0.005) ) ) {
            document.getElementById('checkedLocation').innerHTML = 'Lämpenee...';
        }
		else {
			document.getElementById('checkedLocation').innerHTML = 'Etsiskelehän vielä.';
		}
	}


    var relocateBtn = document.getElementById('relocate');
    relocateBtn.onclick = function(){
        findLocation();
    }

}
</script>

 </body>
</html>