<!DOCTYPE html>
<html>
 <head>
 	<meta charset="UTF-8" />
 	<meta name="viewport" content="width=device-width, initial-scale=1">
 	<title>Aarrejahti</title>
 	<link rel="stylesheet" href="css/jquery.mobile-1.3.1.min.css" type="text/css">
 	<script type="text/javascript" src="js/jquery.js"></script>
 	<script type="text/javascript" src="js/app.js"></script>
 	<script type="text/javascript" src="js/jquery.mobile-1.3.1.min.js"></script>
 	<script type="text/javascript" src="cordova.js"></script>
 	<link rel="stylesheet" href="css/app.css" type="text/css">
    <link rel="stylesheet" href="css/treasure-hunt-pink.css" type="text/css">

 <script type="text/javascript" charset="utf-8">

    // Aarteen sijainti (Veturitallinkatu 5 as. 626, 40100 Jyväskylä)
    var treasureLat = 62.2433; //62.2432626  &&  62.2435172 tarpeeksi lähekkäin
    var treasureLon = 25.7579;  // 25.7580648  &&  25.7577094 tarpeeksi lähekkäin


    //62.2432
    //62.2435

    //25.7580
    //25.7577


    var watchID = null;
    var treasureDistance;

    // Wait for device API libraries to load
    //
    document.addEventListener("deviceready", onDeviceReady, false);
    // device APIs are available
    //
    function onDeviceReady() {
    	findFirstLocation();
    }

    // Funktio, joka paikallistaa käyttäjän longtituden ja latituden avulla sovelluksen käynnistyessä.
    function findFirstLocation() {

        // Throw an error if no update is received every 10 seconds
        var options = {maximumAge: 0, timeout: 10000, enableHighAccuracy:true};
        navigator.geolocation.getCurrentPosition(onFirstSuccess, onError, options);
    }


    // Funktio, joka tarkkaillee käyttäjän sijaintia ja päivittää käyttäjän sijainnin longituden ja latituden tarvittaessa
    function findLocation() {
        document.getElementById('geolocation').innerHTML = 'Etsitään sijaintia...';

        // Throw an error if no update is received every 2 seconds
        var options = {maximumAge: 0, timeout: 2000, enableHighAccuracy:true};
        watchID = navigator.geolocation.watchPosition(onSuccess, onError, options);
    }


    // onFirstSuccess Geolocation
    //
    function onFirstSuccess(position) {
        var element = document.getElementById('geolocation');
        var displat = document.getElementById('latval');
        var displon = document.getElementById('lonval');

        displat.innerHTML = position.coords.latitude;
        displon.innerHTML = position.coords.longitude;


        // Tarkistetaan onko käyttäjä aarteen lähellä
        var userLat = position.coords.latitude;
        var userLon = position.coords.longitude;

        // The first calculated distance to the treasure from user's current location [(treasure long + lat) - (current long + lat)]
        treasureDistance = ( (treasureLat + treasureLon) - (userLat + userLon) ) * (-1);
        console.log(treasureDistance + " current: "  + currentTreasureDistance);


        if ( ( (treasureLat - userLat <= 0.0009 ) && (treasureLat - userLat >= -0.0009) ) &&
            ( (treasureLon - userLon <= 0.0009 ) && (treasureLon - userLon >= -0.0009) ) ) {
                element.innerHTML = 'Olet lähellä aarretta!';
                //showAlert();
                //navigator.geolocation.clearWatch(watchID);
        }
        else if ( ( (treasureLat - userLat <= 0.002 ) && (treasureLat - userLat >= -0.002) ) &&
            ( (treasureLon - userLon <= 0.002 ) && (treasureLon - userLon >= -0.002) ) ) {
                element.innerHTML = 'Olet melko lähellä aarretta';
        }
         else if ( ( (treasureLat - userLat <= 0.005 ) && (treasureLat - userLat >= -0.005) ) &&
            ( (treasureLon - userLon <= 0.005 ) && (treasureLon - userLon >= -0.005) ) ) {
                element.innerHTML = 'Olet vielä melko kaukana aarteesta';
        }
        else {
            element.innerHTML = 'Et ole lähellä aarretta, etsiskelehän vielä';
        }
    }


    // onSuccess Geolocation
    //
    function onSuccess(position) {
        var element = document.getElementById('geolocation');
        var coldWarm = document.getElementById('checkedLocation');
        var displat = document.getElementById('latval');
        var displon = document.getElementById('lonval');

        displat.innerHTML = position.coords.latitude;
        displon.innerHTML = position.coords.longitude;


        // The user's current Lat and Long
        var userLat = position.coords.latitude;
        var userLon = position.coords.longitude;

        // The current distance to the treasure from user's current location [(treasure long + lat) - (current long + lat)]
        var currentTreasureDistance = ( (treasureLat + treasureLon) - (userLat + userLon) ) * (-1);

        console.log(treasureDistance + " current: "  + currentTreasureDistance);

        if ( ( (treasureLat - userLat <= 0.0009 ) && (treasureLat - userLat >= -0.0009) ) &&
            ( (treasureLon - userLon <= 0.0009 ) && (treasureLon - userLon >= -0.0009) ) ) {
                element.innerHTML = 'Olet lähellä aarretta!';
                //showAlert();
                //navigator.geolocation.clearWatch(watchID);
        }
        else if ( ( (treasureLat - userLat <= 0.002 ) && (treasureLat - userLat >= -0.002) ) &&
            ( (treasureLon - userLon <= 0.002 ) && (treasureLon - userLon >= -0.002) ) ) {
                element.innerHTML = 'Olet melko lähellä aarretta';
        }
         else if ( ( (treasureLat - userLat <= 0.005 ) && (treasureLat - userLat >= -0.005) ) &&
            ( (treasureLon - userLon <= 0.005 ) && (treasureLon - userLon >= -0.005) ) ) {
                element.innerHTML = 'Olet vielä melko kaukana aarteesta';
        }
        else {
            element.innerHTML = 'Et ole lähellä aarretta, etsiskelehän vielä';
        }


        if ( (treasureDistance >= currentTreasureDistance) && ( (currentTreasureDistance <= 0.0009) ) ) {
            coldWarm.innerHTML = 'Polttaa';
        }        
        else if (treasureDistance >= currentTreasureDistance) {
            coldWarm.innerHTML = 'Lämpenee';
        }
        else if (treasureDistance < currentTreasureDistance) {
            coldWarm.innerHTML = 'Kylmenee';
        }

        treasureDistance = currentTreasureDistance;

    }



    // onError Callback receives a PositionError object
    //
    function onError(error) {
        alert('Tapahtui virhe.' + '\n' + 'Koodi: '    + error.code    + '\n' +
              'Viesti: ' + error.message + '\n');
    }

    // Jos käyttäjä on aarteen lähellä, näytetään notifikaatio
    function showAlert() {
        navigator.notification.alert(
            'Olet aivan aarteen lähellä!',  // message
            'Polttaa polttaa!',            // title
            'OK'                  // buttonName
        );
    }

    </script>


 </head>
 <body>

    <!-- ****** ETUSIVU ****** -->
 	<div data-role="page" id="home">
 		<div data-role="header">
 			<h1>Aarrejahti</h1>
 		</div>
 		<div data-role="content" class="content">
            <div class="logo-holder centerme">
                <img src="images/logo.png">
            </div>
            <h2>Tervetuloa Aarrejahtiin!</h2>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce molestie blandit tellus. Vivamus cursus, lorem ut pellentesque bibendum, est elit pharetra tellus, lacinia tempus neque arcu eget urna. Aenean sed quam eget ipsum hendrerit molestie. Aliquam tempor diam at elementum fermentum.</p>

            <ul data-role="listview" data-inset="true">
                <li><a href="#campaigns" data-transition="slide">Kampanjat</a></li>
                <li><a href="#termsofuse" data-transition="slide">Käyttöehdot</a></li>
                <li><a href="#info" data-transition="slide">Tietoja</a></li>
            </ul>
            
 		</div>
 		<div data-role="footer" data-position="fixed">
            <div class="ui-grid-a">
                <div class="ui-block-a">
                    <a href="#home" data-role="button" data-icon="home" data-iconpos="notext" data-theme="a" data-inline="true" data-transition="slide">Home</a>
                </div>
                <div class="ui-block-b">
                    <a href="#" data-role="button" data-icon="back" data-iconpos="notext" data-theme="a" data-inline="true" data-transition="slide">Back</a>
                </div>
            </div>
 		</div>
 	</div>


    <!-- **** KAMPANJAT **** -->
    <div data-role="page" id="campaigns">
        <div data-role="header">
            <h1>Aarrejahti</h1>
        </div>
        <div data-role="content" class="content">

            <h2>Käynnissä olevat kampanjat</h2>
            <p>
                Valitse aarrejahti, johon haluat osallistua
            </p>

            <ul data-role="listview" data-inset="true">
                <li><a href="#campaign01" data-transition="slide">Kampanja 1</a></li>
                <li><a href="#" data-transition="slide">Kampanja 2</a></li>
            </ul>
            
        </div>
        <div data-role="footer" data-position="fixed">
            <div class="ui-grid-a">
                <div class="ui-block-a">
                    <a href="#home" data-role="button" data-icon="home" data-iconpos="notext" data-theme="a" data-inline="true" data-transition="slide">Home</a>
                </div>
                <div class="ui-block-b">
                    <a href="#" data-role="button" data-rel="back" data-icon="back" data-iconpos="notext" data-theme="a" data-inline="true" data-transition="slide">Back</a>
                </div>
            </div>
        </div>
    </div>





    <!-- ** YKSITTÄINEN KAMPANJA ** -->
    <div data-role="page" id="campaign01">
        <div data-role="header">
            <h1>Aarrejahti</h1>
        </div>
        <div data-role="content" class="content">

            <h2>Kampanjan nimi</h2>
            <p>
                Lyhyt kuvaus itse kampanjasta, palkinnoista, osallistumisajasta jne... Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce molestie blandit tellus. Vivamus cursus, lorem ut pellentesque bibendum, est elit pharetra tellus, lacinia tempus neque arcu eget urna. Aenean sed quam eget ipsum hendrerit molestie.
            </p>

            <h2>Aarrejahdit</h2>

            <ul data-role="listview" data-inset="true">
                <li data-role="list-divider" data-theme="a">Käynnissä</li>
                <li><a href="#campaign01treasure01" data-transition="slide">Käynnissä oleva aarrejahti 07.01.2014</a></li>
                <li data-role="list-divider" data-theme="a">Menneet</li>
                <li><a href="#" data-transition="slide">Mennyt aarrejahti 01.01.2014</a></li>
            </ul>
            
        </div>
        <div data-role="footer" data-position="fixed">
            <div class="ui-grid-a">
                <div class="ui-block-a">
                    <a href="#home" data-role="button" data-icon="home" data-iconpos="notext" data-theme="a" data-inline="true" data-transition="slide">Home</a>
                </div>
                <div class="ui-block-b">
                    <a href="#" data-role="button" data-rel="back" data-icon="back" data-iconpos="notext" data-theme="a" data-inline="true" data-transition="slide">Back</a>
                </div>
            </div>
        </div>
    </div>


    <!-- ** YKSITTÄISEN KAMPANJAN KÄYNNISSÄ OLEVA AARREJAHTI ** -->
    <div data-role="page" id="campaign01treasure01">
        <div data-role="header">
            <h1>Aarrejahti</h1>
        </div>
        <div data-role="content" class="content">

            <script type="text/javascript" charset="utf-8">
                findLocation();
            </script>

            <p id="geolocation">Etsitään sijaintia...</p>

            <div class="hint-image centerme">
                <img src="images/vihjekuva.jpg">
            </div>

            <div class="ui-grid-a">
                <div class="ui-block-a"><span class="highlight">Latitude:</span></div>
                <div class="ui-block-b"><span id="latval">?</span></div>
            </div>

            <div class="ui-grid-a">
                <div class="ui-block-a"><span class="highlight">Longitude:</span></div>
                <div class="ui-block-b"><span id="lonval">?</span></div>
            </div>

            <br>
            <br>
            <p id="checkedLocation"> </p>
            <br>
            <br>
            <button id="relocate">Tarkista sijainti</button>
            
        </div>
        <div data-role="footer" data-position="fixed">
            <div class="ui-grid-a">
                <div class="ui-block-a">
                    <a href="#home" data-role="button" data-icon="home" data-iconpos="notext" data-theme="a" data-inline="true" data-transition="slide">Home</a>
                </div>
                <div class="ui-block-b">
                    <a href="#" data-role="button" data-rel="back" data-icon="back" data-iconpos="notext" data-theme="a" data-inline="true" data-transition="slide">Back</a>
                </div>
            </div>
        </div>
    </div>


    <!-- **** KÄYTTÖEHDOT **** -->
    <div data-role="page" id="termsofuse">
        <div data-role="header">
            <h1>Aarrejahti</h1>
        </div>
        <div data-role="content" class="content">

            <h2>Käyttöehdot</h2>

            <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse hendrerit, metus nec facilisis venenatis, nunc mauris scelerisque justo, in sodales massa nibh vel mauris. Nam sit amet libero at nulla rutrum porta. Etiam semper non sapien eu sollicitudin. Suspendisse a vehicula neque. In purus purus, accumsan ac magna non, mattis dictum est.
            </p>
            <p>
                Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Curabitur tristique massa felis, at congue quam vehicula sit amet. Phasellus molestie, felis id ultricies auctor, risus est scelerisque arcu, sit amet ornare odio felis eget tellus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In fermentum, massa non auctor lacinia, felis elit posuere libero, vitae varius erat tellus tempus mi. Morbi at lectus at neque convallis tristique.
            </p>
            <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse hendrerit, metus nec facilisis venenatis, nunc mauris scelerisque justo, in sodales massa nibh vel mauris. Nam sit amet libero at nulla rutrum porta. Etiam semper non sapien eu sollicitudin. Suspendisse a vehicula neque. In purus purus, accumsan ac magna non, mattis dictum est.
            </p>
            <p>
                Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Curabitur tristique massa felis, at congue quam vehicula sit amet. Phasellus molestie, felis id ultricies auctor, risus est scelerisque arcu, sit amet ornare odio felis eget tellus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In fermentum, massa non auctor lacinia, felis elit posuere libero, vitae varius erat tellus tempus mi. Morbi at lectus at neque convallis tristique.
            </p>
            
        </div>
        <div data-role="footer" data-position="fixed">
            <div class="ui-grid-a">
                <div class="ui-block-a">
                    <a href="#home" data-role="button" data-icon="home" data-iconpos="notext" data-theme="a" data-inline="true" data-transition="slide">Home</a>
                </div>
                <div class="ui-block-b">
                    <a href="#" data-role="button" data-rel="back" data-icon="back" data-iconpos="notext" data-theme="a" data-inline="true" data-transition="slide">Back</a>
                </div>
            </div>
        </div>
    </div>



    <!-- **** TIETOJA **** -->
    <div data-role="page" id="info">
        <div data-role="header">
            <h1>Aarrejahti</h1>
        </div>
        <div data-role="content" class="content">

            <h2>Tietoja</h2>    

            <p>
                Tänne tulisi jotain pientä informaatiota itse sovelluksesta. Esim. tekijä(t) jne... Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse hendrerit, metus nec facilisis venenatis, nunc mauris scelerisque justo, in sodales massa nibh vel mauris. Nam sit amet libero at nulla rutrum porta. Etiam semper non sapien eu sollicitudin.
            </p>
            <p>
                Suspendisse a vehicula neque. In purus purus, accumsan ac magna non, mattis dictum est. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Curabitur tristique massa felis, at congue quam vehicula sit amet.
            </p>
            
        </div>
        <div data-role="footer" data-position="fixed">
            <div class="ui-grid-a">
                <div class="ui-block-a">
                    <a href="#home" data-role="button" data-icon="home" data-iconpos="notext" data-theme="a" data-inline="true" data-transition="slide">Home</a>
                </div>
                <div class="ui-block-b">
                    <a href="#" data-role="button" data-rel="back" data-icon="back" data-iconpos="notext" data-theme="a" data-inline="true" data-transition="slide">Back</a>
                </div>
            </div>
        </div>
    </div>


 <script type="text/javascript">
 window.onload = function(){
    /*
    // 62.2427925
 	var treasureLat = 62.2427795;
    // 25.7591883
 	var treasureLon = 25.7592863;

    var checkBtn = document.getElementById('checkLocation');
	checkBtn.onclick = function(){
		var userLat = parseFloat(document.getElementById('latval').innerHTML);
		var userLon = parseFloat(document.getElementById('lonval').innerHTML);
		console.log(userLat);
		console.log(userLon);
		if ( ( (treasureLat - userLat <= 0.0009 ) && (treasureLat - userLat >= -0.0000) ) &&
			( (treasureLon - userLon <= 0.0009 ) && (treasureLon - userLon >= -0.0009) ) ) {
			document.getElementById('checkedLocation').innerHTML = 'Olet aivan aarteen lähellä!';
		}
        else if ( ( (treasureLat - userLat <= 0.002 ) && (treasureLat - userLat >= -0.002) ) &&
            ( (treasureLon - userLon <= 0.002 ) && (treasureLon - userLon >= -0.002) ) ) {
            document.getElementById('checkedLocation').innerHTML = 'Alkaa jo polttaa.';
        }
        else if ( ( (treasureLat - userLat <= 0.005 ) && (treasureLat - userLat >= -0.005) ) &&
            ( (treasureLon - userLon <= 0.005 ) && (treasureLon - userLon >= -0.005) ) ) {
            document.getElementById('checkedLocation').innerHTML = 'Lämpenee...';
        }
		else {
			document.getElementById('checkedLocation').innerHTML = 'Etsiskelehän vielä.';
		}
	}
    */

    var relocateBtn = document.getElementById('relocate');
    relocateBtn.onclick = function(){
        findLocation();
    }

}
</script>

 </body>
</html>